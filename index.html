<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ–æ›¸é¤¨æ‰“å¡è¨˜éŒ„</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4562A8;
      --success-color: #34C759;
      --warning-color: #FF9500;
      --danger-color: #FF3B30;
      --background-color: #F2F2F7;
      --card-background: #FFFFFF;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
      background-color: var(--background-color);
      margin: 0;
      padding: 0;
      color: #000000;
    }

    .app-container {
      max-width: 414px;
      margin: 0 auto;
      background: var(--background-color);
      min-height: 100vh;
      position: relative;
      padding-bottom: 60px; /* ç‚ºåº•éƒ¨å°èˆªæ¬„ç•™å‡ºç©ºé–“ */
    }

    .status-bar {
      background: var(--card-background);
      padding: 12px 16px;
      font-size: 14px;
      color: #666;
    }

    .nav-bar {
      background: var(--card-background);
      padding: 16px;
      font-size: 17px;
      font-weight: 600;
      text-align: center;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .card {
      background: var(--card-background);
      border-radius: 16px;
      padding: 20px;
      margin: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .clock-status {
      text-align: center;
      padding: 24px 0;
    }

    .clock-time {
      font-size: 48px;
      font-weight: 300;
      color: var(--primary-color);
      margin-bottom: 8px;
    }

    .clock-date {
      font-size: 15px;
      color: #666;
    }

    .location-card {
      display: flex;
      align-items: center;
      padding: 16px;
      background: #F8F8F8;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .location-icon {
      width: 40px;
      height: 40px;
      background: var(--primary-color);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      margin-right: 12px;
    }

    .clock-button {
      background: var(--success-color);
      color: white;
      border: none;
      border-radius: 24px;
      padding: 16px 32px;
      font-size: 17px;
      font-weight: 600;
      width: 100%;
      margin-top: 16px;
    }

    .clock-button:disabled {
      background: #E5E5EA;
      color: #8E8E93;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }

    .status-item {
      background: #F8F8F8;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }

    .status-value {
      font-size: 24px;
      font-weight: 600;
      color: var(--primary-color);
    }

    .status-label {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-background);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      padding: 12px 0;
      border-top: 1px solid rgba(0,0,0,0.1);
      z-index: 100;
    }

    .tab-item {
      text-align: center;
      color: #8E8E93;
      font-size: 10px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .tab-item:hover {
      opacity: 0.8;
    }

    .tab-item:active {
      opacity: 0.6;
    }

    .tab-item.active {
      color: var(--primary-color);
    }

    .tab-item i {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* é é¢ç‰¹å®šæ¨£å¼ */
    .calendar-page .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 16px;
    }

    .calendar-page .day-item {
      background: #F8F8F8;
      border-radius: 8px;
      padding: 8px 0;
      text-align: center;
      font-size: 14px;
      position: relative;
    }

    .calendar-page .day-item.today {
      background: var(--primary-color);
      color: white;
    }

    .calendar-page .day-item.checked {
      border: 2px solid var(--success-color);
    }

    .calendar-page .day-item.checked:after {
      content: 'âœ“';
      position: absolute;
      top: 2px;
      right: 4px;
      font-size: 10px;
      color: var(--success-color);
    }

    .calendar-page .day-item.today.checked:after {
      color: white;
    }

    .stats-page .chart {
      height: 200px;
      background: #F8F8F8;
      border-radius: 12px;
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .study-log {
      margin-top: 16px;
      max-height: 300px;
      overflow-y: auto;
    }

    .study-item {
      border-left: 2px solid var(--primary-color);
      padding-left: 16px;
      margin-bottom: 16px;
    }

    .study-item:last-child {
      margin-bottom: 0;
    }

    .study-date {
      font-weight: 500;
      font-size: 15px;
    }

    .study-time {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    .study-note {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
      font-style: italic;
    }

    .streak-badge {
      display: inline-block;
      background: var(--primary-color);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 8px;
    }
    
    /* è¡¨å–®å…ƒç´ æ¨£å¼ */
    .form-control {
      border-radius: 10px;
      border: 1px solid #E5E5EA;
      padding: 10px 15px;
      font-size: 15px;
    }
    
    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(69, 98, 168, 0.25);
    }
    
    .btn-light {
      border-radius: 10px;
      border: 1px solid #E5E5EA;
      background-color: #F8F8F8;
    }
    
    .btn-light:hover {
      background-color: #E5E5EA;
    }
    
    .location-option {
      border-radius: 10px;
      margin-bottom: 5px;
      padding: 12px 15px;
    }
    
    .location-option:hover {
      background-color: #F8F8F8;
    }
    
    .modal-content {
      border-radius: 16px;
    }
    
    .modal-header {
      border-bottom: 1px solid #E5E5EA;
    }
    
    #useCurrentTimeBtn {
      height: 38px;
      width: 50px;
      font-size: 13px;
      border-radius: 10px;
      padding: 0;
    }
    
    #timeSelector {
      background: #F8F8F8;
      border-radius: 12px;
      padding: 16px;
    }
    
    #studyNote {
      background: #F8F8F8;
      margin-bottom: 0 !important;
    }
    
    #changeLocationBtn {
      border-radius: 50%;
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- ç‹€æ…‹åˆ— -->
    <div class="status-bar">
      <i class="fas fa-signal"></i>
      <span class="float-end">
        <i class="fas fa-wifi"></i>
        <i class="fas fa-battery-full ms-2"></i>
      </span>
    </div>

    <!-- å°èˆªåˆ— -->
    <div class="nav-bar" id="pageTitle">
      åœ–æ›¸é¤¨æ‰“å¡
    </div>

    <!-- é¦–é  -->
    <div class="page active" id="homePage">
      <!-- ä¸»è¦å…§å®¹ -->
      <div class="card">
        <div class="clock-status">
          <div class="clock-time" id="currentTime">14:30:25</div>
          <div class="clock-date" id="currentDate">2024å¹´3æœˆ21æ—¥ æ˜ŸæœŸå››</div>
        </div>

        <div class="location-card" id="locationSelector">
          <div class="location-icon">
            <i class="fas fa-book"></i>
          </div>
          <div style="flex-grow: 1;">
            <div style="font-weight: 500;">å­¸ç¿’ä½ç½®</div>
            <div style="font-size: 13px; color: #666;" id="selectedLocation">æ ¡å€ä¸­å¤®åœ–æ›¸é¤¨</div>
          </div>
          <div style="margin-left: 10px;">
            <button class="btn btn-sm btn-light" id="changeLocationBtn">
              <i class="fas fa-edit"></i>
            </button>
          </div>
        </div>

        <div class="mb-3" id="timeSelector" style="display: flex; align-items: center; margin-top: 16px;">
          <div style="flex-grow: 1;">
            <label style="font-weight: 500; font-size: 15px; margin-bottom: 5px;">å­¸ç¿’æ™‚é–“</label>
            <input type="datetime-local" class="form-control" id="studyTimeInput">
          </div>
          <div style="width: 60px; text-align: center; font-size: 14px; color: #666;">
            <button class="btn btn-sm btn-light" id="useCurrentTimeBtn" style="margin-top: 24px;">
              ç¾åœ¨
            </button>
          </div>
        </div>

        <input type="text" class="form-control mb-3" id="studyNote" placeholder="å‚™è¨»ï¼šä»Šå¤©å­¸ç¿’äº†ä»€éº¼ï¼Ÿ" style="margin-top: 16px;">

        <button class="clock-button" id="clockButton">
          <i class="fas fa-book-reader me-2"></i>è¨˜éŒ„å­¸ç¿’
        </button>
      </div>

      <!-- ç‹€æ…‹å¡ç‰‡ -->
      <div class="card">
        <div style="font-weight: 600; margin-bottom: 12px;">å­¸ç¿’çµ±è¨ˆ</div>
        <div class="status-grid">
          <div class="status-item">
            <div class="status-value">15</div>
            <div class="status-label">æœ¬æœˆåˆ°é¤¨æ¬¡æ•¸</div>
          </div>
          <div class="status-item">
            <div class="status-value">5</div>
            <div class="status-label">ç›®å‰é€£çºŒå¤©æ•¸</div>
          </div>
          <div class="status-item">
            <div class="status-value">45</div>
            <div class="status-label">æœ¬å­¸æœŸç¸½æ¬¡æ•¸</div>
          </div>
          <div class="status-item">
            <div class="status-value">12</div>
            <div class="status-label">æœ€é•·é€£çºŒè¨˜éŒ„</div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ—¥æ›†é é¢ -->
    <div class="page calendar-page" id="calendarPage">
      <div class="card">
        <div style="font-weight: 600; margin-bottom: 12px;">2024å¹´3æœˆ</div>
        <div class="calendar-grid">
          <div class="day-item">ä¸€</div>
          <div class="day-item">äºŒ</div>
          <div class="day-item">ä¸‰</div>
          <div class="day-item">å››</div>
          <div class="day-item">äº”</div>
          <div class="day-item">å…­</div>
          <div class="day-item">æ—¥</div>
          
          <div class="day-item"></div>
          <div class="day-item"></div>
          <div class="day-item"></div>
          <div class="day-item"></div>
          <div class="day-item checked">1</div>
          <div class="day-item checked">2</div>
          <div class="day-item">3</div>
          
          <div class="day-item checked">4</div>
          <div class="day-item checked">5</div>
          <div class="day-item checked">6</div>
          <div class="day-item">7</div>
          <div class="day-item checked">8</div>
          <div class="day-item">9</div>
          <div class="day-item">10</div>
          
          <div class="day-item checked">11</div>
          <div class="day-item checked">12</div>
          <div class="day-item">13</div>
          <div class="day-item checked">14</div>
          <div class="day-item checked">15</div>
          <div class="day-item checked">16</div>
          <div class="day-item">17</div>
          
          <div class="day-item checked">18</div>
          <div class="day-item checked">19</div>
          <div class="day-item checked">20</div>
          <div class="day-item today checked">21</div>
          <div class="day-item">22</div>
          <div class="day-item">23</div>
          <div class="day-item">24</div>
          
          <div class="day-item">25</div>
          <div class="day-item">26</div>
          <div class="day-item">27</div>
          <div class="day-item">28</div>
          <div class="day-item">29</div>
          <div class="day-item">30</div>
          <div class="day-item">31</div>
        </div>
      </div>
      
      <div class="card">
        <div style="font-weight: 600; margin-bottom: 12px;">æœ€è¿‘åˆ°é¤¨è¨˜éŒ„</div>
        <div class="study-log">
          <div class="study-item">
            <div class="study-date">3æœˆ21æ—¥ï¼ˆä»Šå¤©ï¼‰<span class="streak-badge">é€£çºŒ5å¤©</span></div>
            <div class="study-time">åˆ°é¤¨æ™‚é–“ï¼š09:30</div>
            <div class="study-note">å‚™è¨»ï¼šæº–å‚™æœŸä¸­è€ƒï¼Œè¤‡ç¿’ç·šæ€§ä»£æ•¸</div>
          </div>
          
          <div class="study-item">
            <div class="study-date">3æœˆ20æ—¥</div>
            <div class="study-time">åˆ°é¤¨æ™‚é–“ï¼š10:15</div>
            <div class="study-note">å‚™è¨»ï¼šæ’°å¯«æ­·å²è«–æ–‡</div>
          </div>
          
          <div class="study-item">
            <div class="study-date">3æœˆ19æ—¥</div>
            <div class="study-time">åˆ°é¤¨æ™‚é–“ï¼š14:00</div>
            <div class="study-note">å‚™è¨»ï¼šè‹±èªå£èªç·´ç¿’</div>
          </div>
          
          <div class="study-item">
            <div class="study-date">3æœˆ18æ—¥</div>
            <div class="study-time">åˆ°é¤¨æ™‚é–“ï¼š09:05</div>
            <div class="study-note">å‚™è¨»ï¼šå®Œæˆç¨‹å¼ä½œæ¥­</div>
          </div>
          
          <div class="study-item">
            <div class="study-date">3æœˆ17æ—¥</div>
            <div class="study-time">åˆ°é¤¨æ™‚é–“ï¼š13:30</div>
            <div class="study-note">å‚™è¨»ï¼šå°çµ„è¨è«–æº–å‚™</div>
          </div>
        </div>
      </div>
    </div>

    <!-- çµ±è¨ˆé é¢ -->
    <div class="page stats-page" id="statsPage">
      <div class="card">
        <div style="font-weight: 600; margin-bottom: 12px;">å­¸ç¿’è¶¨å‹¢</div>
        <div class="chart">
          <i class="fas fa-chart-line" style="font-size: 48px; color: #C7C7CC;"></i>
        </div>
        <div style="font-size: 13px; color: #666; text-align: center; margin-top: 8px;">
          é¡¯ç¤ºæœ€è¿‘30å¤©åˆ°é¤¨è¨˜éŒ„çµ±è¨ˆ
        </div>
      </div>
      
      <div class="card">
        <div style="font-weight: 600; margin-bottom: 12px;">å­¸ç¿’åˆ†æ</div>
        <div class="status-grid">
          <div class="status-item">
            <div class="status-value">15</div>
            <div class="status-label">æœ¬æœˆåˆ°é¤¨</div>
          </div>
          <div class="status-item">
            <div class="status-value">71%</div>
            <div class="status-label">å‡ºå¸­ç‡</div>
          </div>
          <div class="status-item">
            <div class="status-value">5</div>
            <div class="status-label">é€£çºŒå¤©æ•¸</div>
          </div>
          <div class="status-item">
            <div class="status-value">12</div>
            <div class="status-label">æœ€é•·é€£çºŒ</div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div style="font-weight: 600; margin-bottom: 12px;">åˆ°é¤¨æ™‚æ®µåˆ†æ</div>
        <div style="display: flex; justify-content: space-between; margin-top: 16px;">
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 24px; font-weight: 600; color: var(--primary-color);">40%</div>
            <div style="font-size: 13px; color: #666;">ä¸Šåˆ</div>
          </div>
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 24px; font-weight: 600; color: var(--primary-color);">35%</div>
            <div style="font-size: 13px; color: #666;">ä¸‹åˆ</div>
          </div>
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 24px; font-weight: 600; color: var(--primary-color);">25%</div>
            <div style="font-size: 13px; color: #666;">æ™šä¸Š</div>
          </div>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨æ¨™ç±¤æ¬„ -->
    <div class="tab-bar">
      <div class="tab-item active" data-page="homePage">
        <i class="fas fa-home"></i><br>
        é¦–é 
      </div>
      <div class="tab-item" data-page="calendarPage">
        <i class="fas fa-calendar-alt"></i><br>
        æ—¥æ›†
      </div>
      <div class="tab-item" data-page="statsPage">
        <i class="fas fa-chart-line"></i><br>
        çµ±è¨ˆ
      </div>
    </div>
  </div>

  <!-- ä½ç½®é¸æ“‡å½ˆçª— -->
  <div class="modal fade" id="locationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">é¸æ“‡ä½ç½®</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="list-group">
            <button type="button" class="list-group-item list-group-item-action location-option" data-location="æ ¡å€ä¸­å¤®åœ–æ›¸é¤¨">
              <i class="fas fa-book-open me-2"></i>æ ¡å€ä¸­å¤®åœ–æ›¸é¤¨
            </button>
            <button type="button" class="list-group-item list-group-item-action location-option" data-location="ç†å·¥å­¸é™¢åœ–æ›¸é¤¨">
              <i class="fas fa-flask me-2"></i>ç†å·¥å­¸é™¢åœ–æ›¸é¤¨
            </button>
            <button type="button" class="list-group-item list-group-item-action location-option" data-location="ç¤¾ç§‘é™¢åœ–æ›¸é¤¨">
              <i class="fas fa-landmark me-2"></i>ç¤¾ç§‘é™¢åœ–æ›¸é¤¨
            </button>
            <button type="button" class="list-group-item list-group-item-action location-option" data-location="å•†å­¸é™¢åœ–æ›¸é¤¨">
              <i class="fas fa-chart-line me-2"></i>å•†å­¸é™¢åœ–æ›¸é¤¨
            </button>
            <button type="button" class="list-group-item list-group-item-action location-option" data-location="é†«å­¸é™¢åœ–æ›¸é¤¨">
              <i class="fas fa-heartbeat me-2"></i>é†«å­¸é™¢åœ–æ›¸é¤¨
            </button>
            <button type="button" class="list-group-item list-group-item-action location-option" data-location="æ³•å­¸é™¢åœ–æ›¸é¤¨">
              <i class="fas fa-gavel me-2"></i>æ³•å­¸é™¢åœ–æ›¸é¤¨
            </button>
            <div class="mt-3">
              <input type="text" class="form-control" id="customLocation" placeholder="è¼¸å…¥å…¶ä»–ä½ç½®...">
              <button class="btn btn-primary w-100 mt-2" id="addCustomLocation">æ–°å¢ä½ç½®</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script>
    // æ•¸æ“šå­˜å„²ç®¡ç†
    const studyRecordManager = {
      records: [],
      
      // åˆå§‹åŒ–å¾æœ¬åœ°å­˜å„²åŠ è¼‰æ•¸æ“š
      init: function() {
        const savedRecords = localStorage.getItem('studyRecords');
        if (savedRecords) {
          this.records = JSON.parse(savedRecords);
        }
        this.updateStats();
        this.updateCalendar();
        this.renderRecentRecords();
        this.renderCharts();
      },
      
      // æ·»åŠ æ–°è¨˜éŒ„
      addRecord: function(record) {
        // æ·»åŠ å”¯ä¸€IDå’Œæ™‚é–“æˆ³
        record.id = Date.now();
        record.timestamp = new Date().toISOString();
        this.records.push(record);
        this.saveToLocalStorage();
        this.updateStats();
        this.updateCalendar();
        this.renderRecentRecords();
        this.renderCharts();
        
        // æª¢æŸ¥é€£çºŒæ‰“å¡ä¸¦é¡¯ç¤ºæˆå°±
        const streak = this.getCurrentStreak();
        if (streak >= 3) {
          showNotification(`ğŸ‰ æ­å–œé”æˆé€£çºŒ${streak}å¤©å­¸ç¿’ï¼`, 'success');
        }
      },
      
      // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
      saveToLocalStorage: function() {
        localStorage.setItem('studyRecords', JSON.stringify(this.records));
      },
      
      // ç²å–æœ€è¿‘è¨˜éŒ„
      getRecentRecords: function(limit = 5) {
        return this.records
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .slice(0, limit);
      },
      
      // ç²å–ç‰¹å®šæ—¥æœŸçš„è¨˜éŒ„
      getRecordsByDate: function(date) {
        const dateStr = new Date(date).toLocaleDateString('zh-Hant');
        return this.records.filter(record => 
          new Date(record.date).toLocaleDateString('zh-Hant') === dateStr
        );
      },
      
      // ç²å–ç•¶å‰æœˆçš„è¨˜éŒ„
      getCurrentMonthRecords: function() {
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        
        return this.records.filter(record => {
          const recordDate = new Date(record.date);
          return recordDate.getMonth() === currentMonth && 
                 recordDate.getFullYear() === currentYear;
        });
      },
      
      // è¨ˆç®—ç•¶å‰é€£çºŒå¤©æ•¸
      getCurrentStreak: function() {
        if (this.records.length === 0) return 0;
        
        const sortedDates = [...new Set(
          this.records.map(record => 
            new Date(record.date).toLocaleDateString('zh-Hant')
          )
        )].sort((a, b) => new Date(b) - new Date(a));
        
        let streak = 1;
        const today = new Date().toLocaleDateString('zh-Hant');
        const yesterday = new Date(Date.now() - 86400000).toLocaleDateString('zh-Hant');
        
        // å…ˆæª¢æŸ¥ä»Šå¤©æ˜¯å¦æ‰“å¡
        if (sortedDates[0] !== today && sortedDates[0] !== yesterday) {
          return 0; // å¦‚æœæœ€è¿‘ä¸€å¤©ä¸æ˜¯ä»Šå¤©æˆ–æ˜¨å¤©ï¼Œé€£çºŒè¨˜éŒ„ä¸­æ–·
        }
        
        // è¨ˆç®—é€£çºŒå¤©æ•¸
        for (let i = 0; i < sortedDates.length - 1; i++) {
          const currentDate = new Date(sortedDates[i]);
          const nextDate = new Date(sortedDates[i + 1]);
          
          const diffTime = currentDate - nextDate;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays === 1) {
            streak++;
          } else {
            break;
          }
        }
        
        return streak;
      },
      
      // è¨ˆç®—æœ€é•·é€£çºŒå¤©æ•¸
      getLongestStreak: function() {
        if (this.records.length === 0) return 0;
        
        const sortedDates = [...new Set(
          this.records.map(record => 
            new Date(record.date).toLocaleDateString('zh-Hant')
          )
        )].sort((a, b) => new Date(a) - new Date(b));
        
        let currentStreak = 1;
        let maxStreak = 1;
        
        for (let i = 0; i < sortedDates.length - 1; i++) {
          const currentDate = new Date(sortedDates[i]);
          const nextDate = new Date(sortedDates[i + 1]);
          
          const diffTime = nextDate - currentDate;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays === 1) {
            currentStreak++;
            maxStreak = Math.max(maxStreak, currentStreak);
          } else {
            currentStreak = 1;
          }
        }
        
        return maxStreak;
      },
      
      // æ›´æ–°çµ±è¨ˆæ•¸æ“š
      updateStats: function() {
        const currentMonthRecords = this.getCurrentMonthRecords();
        const currentStreak = this.getCurrentStreak();
        const longestStreak = this.getLongestStreak();
        const totalRecords = this.records.length;
        
        // æ›´æ–°é¦–é çµ±è¨ˆ
        document.querySelectorAll('.status-grid .status-item .status-value')[0].textContent = 
          currentMonthRecords.length;
        document.querySelectorAll('.status-grid .status-item .status-value')[1].textContent = 
          currentStreak;
        document.querySelectorAll('.status-grid .status-item .status-value')[2].textContent = 
          totalRecords;
        document.querySelectorAll('.status-grid .status-item .status-value')[3].textContent = 
          longestStreak;
          
        // æ›´æ–°çµ±è¨ˆé é¢æ•¸æ“š
        const statsPageItems = document.querySelectorAll('#statsPage .status-grid .status-item .status-value');
        statsPageItems[0].textContent = currentMonthRecords.length;
        
        // è¨ˆç®—å‡ºå¸­ç‡ (æœ¬æœˆæ‰“å¡å¤©æ•¸/ç•¶å‰æ—¥æœŸ)
        const now = new Date();
        const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        const daysPassed = Math.min(now.getDate(), daysInMonth);
        const attendanceRate = Math.round((currentMonthRecords.length / daysPassed) * 100);
        statsPageItems[1].textContent = attendanceRate + '%';
        
        statsPageItems[2].textContent = currentStreak;
        statsPageItems[3].textContent = longestStreak;
        
        // è¨ˆç®—æ™‚æ®µåˆ†ä½ˆ
        const timeDistribution = {morning: 0, afternoon: 0, evening: 0};
        this.records.forEach(record => {
          const hour = new Date(record.date).getHours();
          if (hour < 12) timeDistribution.morning++;
          else if (hour < 18) timeDistribution.afternoon++;
          else timeDistribution.evening++;
        });
        
        const total = this.records.length || 1; // é¿å…é™¤ä»¥é›¶
        const morningPercent = Math.round((timeDistribution.morning / total) * 100);
        const afternoonPercent = Math.round((timeDistribution.afternoon / total) * 100);
        const eveningPercent = Math.round((timeDistribution.evening / total) * 100);
        
        const timeDistElements = document.querySelectorAll('#statsPage .card:last-child .status-value');
        if (timeDistElements.length >= 3) {
          timeDistElements[0].textContent = morningPercent + '%';
          timeDistElements[1].textContent = afternoonPercent + '%';
          timeDistElements[2].textContent = eveningPercent + '%';
        }
      },
      
      // æ›´æ–°æ—¥æ›†é é¢
      updateCalendar: function() {
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();
        
        // è¨­ç½®æ—¥æ›†æ¨™é¡Œ
        const calendarTitle = document.querySelector('.calendar-page .card:first-child div:first-child');
        calendarTitle.textContent = `${currentYear}å¹´${currentMonth + 1}æœˆ`;
        
        // ç²å–ç•¶æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå¹¾
        const firstDay = new Date(currentYear, currentMonth, 1).getDay() || 7; // å°‡æ˜ŸæœŸæ—¥(0)è½‰ç‚º7
        
        // ç²å–ç•¶æœˆå¤©æ•¸
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        
        // æ¸…é™¤åŸæœ‰æ—¥æœŸ
        const dayItems = document.querySelectorAll('.calendar-grid .day-item');
        for (let i = 7; i < dayItems.length; i++) {
          dayItems[i].textContent = '';
          dayItems[i].classList.remove('checked', 'today');
        }
        
        // è¨­ç½®æ—¥æœŸå’Œæ¨™è¨˜
        for (let i = 1; i <= daysInMonth; i++) {
          const dayIndex = i + firstDay + 6; // 7å€‹è¡¨é ­ + åç§»
          if (dayIndex < dayItems.length) {
            dayItems[dayIndex].textContent = i;
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºä»Šå¤©
            if (i === now.getDate()) {
              dayItems[dayIndex].classList.add('today');
            }
            
            // æª¢æŸ¥æ˜¯å¦æœ‰è¨˜éŒ„
            const dateToCheck = new Date(currentYear, currentMonth, i);
            const hasRecord = this.records.some(record => {
              const recordDate = new Date(record.date);
              return recordDate.getDate() === i && 
                     recordDate.getMonth() === currentMonth && 
                     recordDate.getFullYear() === currentYear;
            });
            
            if (hasRecord) {
              dayItems[dayIndex].classList.add('checked');
            }
            
            // æ·»åŠ é»æ“Šäº‹ä»¶
            dayItems[dayIndex].onclick = () => {
              this.showDayDetails(new Date(currentYear, currentMonth, i));
            };
          }
        }
      },
      
      // é¡¯ç¤ºæŸå¤©è©³æƒ…
      showDayDetails: function(date) {
        const records = this.getRecordsByDate(date);
        const dateStr = date.toLocaleDateString('zh-Hant', {
          month: 'long',
          day: 'numeric'
        });
        
        if (records.length === 0) {
          alert(`${dateStr}æ²’æœ‰å­¸ç¿’è¨˜éŒ„`);
          return;
        }
        
        // æ ¼å¼åŒ–è¨˜éŒ„é¡¯ç¤º
        let message = `${dateStr}å­¸ç¿’è¨˜éŒ„ï¼š\n\n`;
        records.forEach((record, index) => {
          const time = new Date(record.date).toLocaleTimeString('zh-Hant', {
            hour: '2-digit',
            minute: '2-digit'
          });
          message += `${index + 1}. æ™‚é–“ï¼š${time}\n   ä½ç½®ï¼š${record.location}\n   å‚™è¨»ï¼š${record.note || 'ç„¡'}\n\n`;
        });
        
        alert(message);
      },
      
      // æ¸²æŸ“æœ€è¿‘è¨˜éŒ„
      renderRecentRecords: function() {
        const recentRecords = this.getRecentRecords();
        const logContainer = document.querySelector('.study-log');
        logContainer.innerHTML = '';
        
        const currentStreak = this.getCurrentStreak();
        
        recentRecords.forEach((record, index) => {
          const recordDate = new Date(record.date);
          const isToday = recordDate.toLocaleDateString() === new Date().toLocaleDateString();
          
          const dateString = recordDate.toLocaleDateString('zh-Hant', {
            month: 'numeric',
            day: 'numeric'
          });
          
          const timeString = recordDate.toLocaleTimeString('zh-Hant', {
            hour: '2-digit',
            minute: '2-digit'
          });
          
          const item = document.createElement('div');
          item.className = 'study-item';
          
          item.innerHTML = `
            <div class="study-date">${dateString}${isToday ? 'ï¼ˆä»Šå¤©ï¼‰' : ''}
              ${index === 0 && currentStreak > 0 ? `<span class="streak-badge">é€£çºŒ${currentStreak}å¤©</span>` : ''}
            </div>
            <div class="study-time">åˆ°é¤¨æ™‚é–“ï¼š${timeString}</div>
            <div class="study-note">å‚™è¨»ï¼š${record.note || 'ç„¡'}</div>
          `;
          
          logContainer.appendChild(item);
        });
        
        // å¦‚æœæ²’æœ‰è¨˜éŒ„ï¼Œé¡¯ç¤ºæç¤º
        if (recentRecords.length === 0) {
          logContainer.innerHTML = '<div style="text-align: center; color: #666;">æš«ç„¡å­¸ç¿’è¨˜éŒ„</div>';
        }
      },
      
      // æ¸²æŸ“åœ–è¡¨
      renderCharts: function() {
        this.renderTrendChart();
      },
      
      // æ¸²æŸ“è¶¨å‹¢åœ–è¡¨
      renderTrendChart: function() {
        const chartContainer = document.querySelector('#statsPage .chart');
        chartContainer.innerHTML = '<canvas id="trendChart"></canvas>';
        
        // ç²å–éå»30å¤©çš„æ•¸æ“š
        const data = this.getLast30DaysData();
        
        // å‰µå»ºåœ–è¡¨
        const ctx = document.getElementById('trendChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'å­¸ç¿’è¨˜éŒ„',
              data: data.values,
              fill: false,
              borderColor: '#4562A8',
              tension: 0.1,
              pointBackgroundColor: '#4562A8'
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  title: function(context) {
                    return data.tooltips[context[0].dataIndex];
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            }
          }
        });
      },
      
      // ç²å–éå»30å¤©çš„æ•¸æ“š
      getLast30DaysData: function() {
        const result = {
          labels: [],
          values: [],
          tooltips: []
        };
        
        // ç”Ÿæˆéå»30å¤©çš„æ—¥æœŸ
        const now = new Date();
        for (let i = 29; i >= 0; i--) {
          const date = new Date(now);
          date.setDate(date.getDate() - i);
          
          // çŸ­æ¨™ç±¤ (å¦‚ "3/15")
          result.labels.push(`${date.getMonth() + 1}/${date.getDate()}`);
          
          // å®Œæ•´æ¨™ç±¤ (ç”¨æ–¼å·¥å…·æç¤º)
          result.tooltips.push(date.toLocaleDateString('zh-Hant', {
            month: 'long',
            day: 'numeric'
          }));
          
          // è¨˜éŒ„æ•¸é‡
          const recordsForDay = this.getRecordsByDate(date).length;
          result.values.push(recordsForDay > 0 ? 1 : 0); // äºŒå…ƒæ•¸æ“šï¼šæœ‰ç„¡æ‰“å¡
        }
        
        return result;
      }
    };

    // åˆå§‹åŒ–Bootstrapæ¨¡æ…‹æ¡†
    const locationModal = new bootstrap.Modal(document.getElementById('locationModal'));
    
    // é€šçŸ¥ç³»çµ±
    function showNotification(message, type = 'info') {
      // å‰µå»ºé€šçŸ¥å…ƒç´ 
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          ${message}
        </div>
      `;
      
      // æ·»åŠ åˆ°é é¢
      document.body.appendChild(notification);
      
      // å‹•ç•«é¡¯ç¤º
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);
      
      // è‡ªå‹•æ¶ˆå¤±
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 3000);
    }
    
    // è«‹æ±‚é€šçŸ¥æ¬Šé™
    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission();
      }
    }
    
    // ç™¼é€ç³»çµ±é€šçŸ¥
    function sendSystemNotification(title, body) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, {
          body: body,
          icon: 'https://cdn-icons-png.flaticon.com/512/2232/2232688.png'
        });
      }
    }
    
    // è¨­ç½®å­¸ç¿’æé†’
    function setStudyReminder() {
      // ç²å–ä¸Šæ¬¡å­¸ç¿’è¨˜éŒ„æ™‚é–“
      const lastRecord = studyRecordManager.records
        .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
      
      if (!lastRecord) return;
      
      const lastDate = new Date(lastRecord.date);
      const now = new Date();
      
      // å¦‚æœç•¶å¤©æ²’æœ‰è¨˜éŒ„ä¸”æ˜¯ä¸Šåˆ9é»å¾Œï¼Œç™¼é€æé†’
      if (lastDate.toLocaleDateString() !== now.toLocaleDateString() && 
          now.getHours() >= 9) {
        sendSystemNotification(
          'å­¸ç¿’æé†’',
          'ä»Šå¤©é‚„æ²’æœ‰è¨˜éŒ„å­¸ç¿’ï¼Œè¦ä¿æŒé€£çºŒæ‰“å¡è¨˜éŒ„å–”ï¼'
        );
      }
    }
    
    // æ—¥æœŸå’Œæ™‚é–“æ›´æ–°
    function updateDateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('zh-Hant', { hour12: false });
      const dateString = now.toLocaleDateString('zh-Hant', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });
      
      document.getElementById('currentTime').textContent = timeString;
      document.getElementById('currentDate').textContent = dateString;
    }

    function formatDateTimeLocal(date) {
      // å°‡æ—¥æœŸæ ¼å¼åŒ–ç‚º datetime-local è¼¸å…¥æ¡†æ‰€éœ€æ ¼å¼
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      
      return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    // è¨­ç½®ç•¶å‰æ™‚é–“ç‚ºé è¨­è¼¸å…¥æ™‚é–“
    const now = new Date();
    document.getElementById('studyTimeInput').value = formatDateTimeLocal(now);

    setInterval(updateDateTime, 1000);
    updateDateTime();

    // æ‰“å¡æŒ‰éˆ•é»æ“Šäº‹ä»¶
    const clockButton = document.getElementById('clockButton');
    let isCheckedIn = false; // å°šæœªè¨˜éŒ„
    
    clockButton.addEventListener('click', function() {
      const selectedLocation = document.getElementById('selectedLocation').textContent;
      const studyTime = document.getElementById('studyTimeInput').value;
      const studyNote = document.getElementById('studyNote').value;
      
      if (!studyTime) {
        showNotification('è«‹é¸æ“‡å­¸ç¿’æ™‚é–“', 'warning');
        return;
      }
      
      // æ·»åŠ è¨˜éŒ„
      studyRecordManager.addRecord({
        location: selectedLocation,
        date: new Date(studyTime),
        note: studyNote
      });
      
      this.innerHTML = '<i class="fas fa-check-circle me-2"></i>å·²è¨˜éŒ„å­¸ç¿’';
      this.style.background = '#8E8E93';
      isCheckedIn = true;
      
      // é¡¯ç¤ºç¢ºèªè¨Šæ¯
      showNotification('å­¸ç¿’è¨˜éŒ„æˆåŠŸï¼', 'success');
      
      // é‡ç½®æŒ‰éˆ•ï¼ˆ5ç§’å¾Œï¼‰
      setTimeout(() => {
        this.innerHTML = '<i class="fas fa-book-reader me-2"></i>è¨˜éŒ„å­¸ç¿’';
        this.style.background = 'var(--success-color)';
        isCheckedIn = false;
      }, 5000);
      
      // æ¸…ç©ºå‚™è¨»
      document.getElementById('studyNote').value = '';
    });

    // ä½¿ç”¨ç•¶å‰æ™‚é–“æŒ‰éˆ•
    document.getElementById('useCurrentTimeBtn').addEventListener('click', function() {
      document.getElementById('studyTimeInput').value = formatDateTimeLocal(new Date());
    });

    // æ¨™ç±¤æ¬„é é¢åˆ‡æ›
    const tabItems = document.querySelectorAll('.tab-item');
    const pages = document.querySelectorAll('.page');
    const pageTitle = document.getElementById('pageTitle');
    
    // é é¢æ¨™é¡Œå°æ‡‰
    const pageTitles = {
      'homePage': 'åœ–æ›¸é¤¨æ‰“å¡',
      'calendarPage': 'åˆ°é¤¨æ—¥æ›†',
      'statsPage': 'å­¸ç¿’çµ±è¨ˆ'
    };
    
    tabItems.forEach(item => {
      item.addEventListener('click', function() {
        // ç§»é™¤æ‰€æœ‰æ´»å‹•ç‹€æ…‹
        tabItems.forEach(tab => tab.classList.remove('active'));
        pages.forEach(page => page.classList.remove('active'));
        
        // è¨­ç½®æ´»å‹•é é¢
        const pageId = this.getAttribute('data-page');
        document.getElementById(pageId).classList.add('active');
        this.classList.add('active');
        
        // æ›´æ–°é é¢æ¨™é¡Œ
        pageTitle.textContent = pageTitles[pageId];
        
        // å¦‚æœåˆ‡æ›åˆ°çµ±è¨ˆé é¢ï¼Œé‡æ–°æ¸²æŸ“åœ–è¡¨
        if (pageId === 'statsPage') {
          studyRecordManager.renderCharts();
        }
      });
    });
    
    // ä½ç½®é¸æ“‡ç›¸é—œåŠŸèƒ½
    document.getElementById('changeLocationBtn').addEventListener('click', function() {
      locationModal.show();
    });
    
    // é»æ“Šé è¨­ä½ç½®é¸é …
    document.querySelectorAll('.location-option').forEach(option => {
      option.addEventListener('click', function() {
        const location = this.getAttribute('data-location');
        document.getElementById('selectedLocation').textContent = location;
        locationModal.hide();
      });
    });
    
    // æ·»åŠ è‡ªå®šç¾©ä½ç½®
    document.getElementById('addCustomLocation').addEventListener('click', function() {
      const customLocation = document.getElementById('customLocation').value.trim();
      if (customLocation) {
        document.getElementById('selectedLocation').textContent = customLocation;
        document.getElementById('customLocation').value = '';
        locationModal.hide();
      } else {
        showNotification('è«‹è¼¸å…¥ä½ç½®åç¨±', 'warning');
      }
    });
    
    // æ·»åŠ é€šçŸ¥æ¨£å¼
    const notificationStyle = document.createElement('style');
    notificationStyle.textContent = `
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        max-width: 300px;
        padding: 15px 20px;
        border-radius: 12px;
        background: rgba(0,0,0,0.8);
        color: white;
        font-size: 14px;
        z-index: 9999;
        transform: translateY(-20px);
        opacity: 0;
        transition: all 0.3s ease;
      }
      
      .notification.show {
        transform: translateY(0);
        opacity: 1;
      }
      
      .notification.success {
        background: rgba(52, 199, 89, 0.9);
      }
      
      .notification.warning {
        background: rgba(255, 149, 0, 0.9);
      }
      
      .notification.error {
        background: rgba(255, 59, 48, 0.9);
      }
    `;
    document.head.appendChild(notificationStyle);
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // åˆå§‹åŒ–æ•¸æ“š
      studyRecordManager.init();
      
      // è«‹æ±‚é€šçŸ¥æ¬Šé™
      requestNotificationPermission();
      
      // è¨­ç½®å®šæœŸæª¢æŸ¥å­¸ç¿’æé†’ï¼ˆæ¯å°æ™‚æª¢æŸ¥ä¸€æ¬¡ï¼‰
      setInterval(setStudyReminder, 3600 * 1000);
      
      // åˆå§‹é¡¯ç¤ºé€šçŸ¥
      setTimeout(() => {
        showNotification('æ­¡è¿ä½¿ç”¨åœ–æ›¸é¤¨æ‰“å¡ç³»çµ±ï¼');
      }, 1000);
    });
  </script>
</body>
</html>